/*! WP User Manager - v0.1.0
 * http://wp-user-manager.com
 * Copyright (c) 2015; * Licensed GPLv2+ */
jQuery(document).ready(function(a){var b={init:function(){this.general(),this.restore_emails(),this.order_default_fields(),this.restore_default_fields(),this.custom_fields_editor()},general:function(){jQuery(".select2, .wppf-multiselect").select2()},restore_emails:function(){a("#wpum-restore-emails").on("click",function(b){if(b.preventDefault(),!confirm(wpum_admin_js.confirm))return!1;var c=a("#wpum_backend_security").val();a.ajax({type:"GET",dataType:"json",url:wpum_admin_js.ajax,data:{action:"wpum_restore_emails",wpum_backend_security:c},beforeSend:function(){a(".wpum-spinner").hide(),a(".wpum-ajax-done-message").hide(),a("#wpum-restore-emails").after('<span id="wpum-spinner" class="spinner wpum-spinner"></span>')},success:function(b){a("#wpum-restore-emails").after('<p class="wpum-ajax-done-message"> <span class="dashicons dashicons-yes"></span> '+b.data.message+"</p>"),a(".wpum-spinner").hide()},error:function(a){alert(a.responseText)}})})},order_default_fields:function(){a.isFunction(a.fn.sortable)&&a(".users_page_wpum-custom-fields-editor tbody").sortable({helper:this.sortable_table_fix,axis:"y",cursor:"pointer",opacity:.5,placeholder:"row-dragging",delay:150,handle:".column-order, .move-field",update:function(){a(this).children("tr").each(function(){a(this).children("td:first-child").html(a(this).index()),a(this).data("priority",a(this).index())}),dataArray=a.map(a(this).children("tr"),function(b){return{priority:a(b).data("priority"),meta:a(b).data("meta"),required:a(b).data("required"),show_on_signup:a(b).data("show_on_signup")}});var b=a("#_wpnonce").val();a.ajax({type:"POST",dataType:"json",url:wpum_admin_js.ajax,data:{action:"wpum_update_fields_order",items:dataArray,wpum_editor_nonce:b},beforeSend:function(){a("#setting-error-").remove();var b=a(".wp-list-table").height();a(".wpum-table-loader").css("display","table"),a(".wpum-table-loader").css("height",b)},success:function(b){a(".users_page_wpum-custom-fields-editor").find("tr").removeClass("alternate"),a(".users_page_wpum-custom-fields-editor").find("tr:even").addClass("alternate"),a(".wpum-table-loader").hide(),a(".wpum-page-title").after('<div id="setting-error-" class="updated settings-error"><p><strong>'+b.data.message+"</strong></p></div>")},error:function(a){alert(a.responseText)}})}}).disableSelection()},sortable_table_fix:function(b,c){var d=c.children(),e=c.clone();return e.children().each(function(b){a(this).width(d.eq(b).width())}),e},restore_default_fields:function(){a("#wpum-restore-default-fields").on("click",function(b){if(b.preventDefault(),!confirm(wpum_admin_js.confirm))return!1;var c=a("#wpum_backend_fields_restore").val();a.ajax({type:"GET",dataType:"json",url:wpum_admin_js.ajax,data:{action:"wpum_restore_default_fields",wpum_backend_fields_restore:c},beforeSend:function(){a(".wpum-spinner").remove(),a(".wpum-ajax-done-message").remove(),a("#wpum-restore-default-fields").after('<span id="wpum-spinner" class="spinner wpum-spinner is-active"></span>')},success:function(b){a("#wpum-restore-default-fields").after('<p class="wpum-ajax-done-message"> <span class="dashicons dashicons-yes"></span> '+b.data.message+"</p>"),a(".wpum-spinner").remove()},error:function(a){alert(a.responseText)}})})},custom_fields_editor:function(){a(".users_page_wpum-custom-fields-editor td.column-edit a").on("click",function(c){c.preventDefault();var d=a(this).parent().parent(),e=a(this).data("meta"),f=a(this).next().val();a(".users_page_wpum-custom-fields-editor tr").removeClass("editing"),a(".wpum-fields-editor").remove(),a.ajax({type:"POST",dataType:"json",url:wpum_admin_js.ajax,data:{action:"wpum_load_field_editor",field_meta:e,field_nonce:f},beforeSend:function(){var b=a(".wp-list-table").height();a(".wpum-table-loader").css("display","table"),a(".wpum-table-loader").css("height",b),a(".wpum-table-loader #wpum-spinner").addClass("is-active"),a(d).addClass("editing")},success:function(c){a(".wpum-table-loader").hide(),a(".wpum-table-loader #wpum-spinner").removeClass("is-active"),a(".users_page_wpum-custom-fields-editor tbody").sortable("disable"),a(c).insertAfter(d),a("html, body").animate({scrollTop:a(".wpum-fields-editor").offset().top},800),a("#delete-action a").on("click",function(b){return b.preventDefault(),a(d).removeClass("editing"),a(".wpum-fields-editor").remove(),a(".users_page_wpum-custom-fields-editor tbody").sortable("enable"),a("html, body").animate({scrollTop:a(d).offset().top},800),!1}),a(".wpum-fields-editor form").on("submit",function(c){c.preventDefault();var d=a(this).find("#_wpnonce").val();a(this).find(":checkbox:not(:checked)").attr("value",!1);var f=a(this).serializeJSON({checkboxUncheckedValue:"false"});b.update_custom_field(f,d,e)})},error:function(b){a(".wpum-table-loader").hide(),alert(b.responseText)}})})},update_custom_field:function(b,c,d){a.ajax({type:"POST",dataType:"json",url:wpum_admin_js.ajax,data:{action:"wpum_update_single_field",update_nonce:c,field:d,options:b},beforeSend:function(){},success:function(){},error:function(a){alert(a.responseText)}})}};b.init()});