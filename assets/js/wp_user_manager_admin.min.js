/*! WP User Manager - v0.1.0
 * http://wp-user-manager.com
 * Copyright (c) 2015; * Licensed GPLv2+ */
jQuery(document).ready(function(a){var b={init:function(){this.general(),this.restore_emails(),this.order_default_fields(),this.restore_default_fields(),this.fields_window_manager(),this.custom_fields_editor()},general:function(){jQuery(".select2, .wppf-multiselect").select2()},restore_emails:function(){a("#wpum-restore-emails").on("click",function(b){if(b.preventDefault(),!confirm(wpum_admin_js.confirm))return!1;var c=a("#wpum_backend_security").val();a.ajax({type:"GET",dataType:"json",url:wpum_admin_js.ajax,data:{action:"wpum_restore_emails",wpum_backend_security:c},beforeSend:function(){a(".wpum-spinner").hide(),a(".wpum-ajax-done-message").hide(),a("#wpum-restore-emails").after('<span id="wpum-spinner" class="spinner wpum-spinner"></span>')},success:function(b){a("#wpum-restore-emails").after('<p class="wpum-ajax-done-message"> <span class="dashicons dashicons-yes"></span> '+b.data.message+"</p>"),a(".wpum-spinner").hide()},error:function(a){alert(a.responseText)}})})},order_default_fields:function(){if(a.isFunction(a.fn.sortable)){var b=a(".users_page_wpum-custom-fields-editor").height(),c=a(".users_page_wpum-custom-fields-editor").width();a(".wpum-table-loader").height(b).width(c),a(".users_page_wpum-custom-fields-editor tbody").sortable({helper:this.sortable_table_fix,axis:"y",cursor:"pointer",opacity:.5,placeholder:"row-dragging",delay:150,handle:".column-order, .move-field",update:function(){a(this).children("tr").each(function(){a(this).children("td:first-child").html(a(this).index()),a(this).data("order",a(this).index())})}}).disableSelection()}},sortable_table_fix:function(b,c){var d=c.children(),e=c.clone();return e.children().each(function(b){a(this).width(d.eq(b).width())}),e},restore_default_fields:function(){a("#wpum-restore-default-fields").on("click",function(b){if(b.preventDefault(),!confirm(wpum_admin_js.confirm))return!1;var c=a("#wpum_backend_fields_restore").val();a.ajax({type:"GET",dataType:"json",url:wpum_admin_js.ajax,data:{action:"wpum_restore_default_fields",wpum_backend_fields_restore:c},beforeSend:function(){a(".wpum-spinner").hide(),a(".wpum-ajax-done-message").hide(),a("#wpum-restore-default-fields").after('<span id="wpum-spinner" class="spinner wpum-spinner"></span>')},success:function(b){a("#wpum-restore-default-fields").after('<p class="wpum-ajax-done-message"> <span class="dashicons dashicons-yes"></span> '+b.data.message+"</p>"),a(".wpum-spinner").hide()},error:function(a){alert(a.responseText)}})})},fields_window_manager:function(){a(".wpum-trigger-modal").on("click",function(b){b.preventDefault();var c=a(this).data("field"),d="#window-"+c;a(d).show(),a(".media-modal-close").on("click",function(){return a(d).hide(),a(d).find(".wpum-spinner").remove(),!1});var e=a(d).find(".button-primary"),f=a(d).find("#"+c).val(),g=a(d).find("#"+c+"_field_required").val(),h=a(d).find("#"+c+"_field_display").val();a("#"+c+"_field_required").on("change",function(){g=this.value}),a("#"+c+"_field_display").on("change",function(){h=this.value}),a(e).on("click",function(){return a.ajax({type:"GET",dataType:"json",url:wpum_admin_js.ajax,data:{action:"wpum_update_single_default_field",update_nonce:f,field:c,required:g,show_on_signup:h},beforeSend:function(){a(".settings-error").remove(),a(d).find(".wpum-spinner").remove(),a(e).before('<span id="wpum-spinner" class="spinner wpum-spinner modal-spinner"></span>'),a(this).attr("disabled","disabled")},success:function(b){1==b.data.valid?(a(d).find(".wpum-spinner").remove(),a(d).hide(),a(".wpum-page-title").after('<div id="setting-error-" class="updated settings-error"><p><strong>'+b.data.message+"</strong></p></div>"),location.reload(!0)):alert(b.data.message)},error:function(a){alert(a.responseText)}}),!1})})},custom_fields_editor:function(){a(".users_page_wpum-custom-fields-editor td.column-edit a").on("click",function(b){b.preventDefault();var c=a(this).parent().parent(),d=a(this).data("meta"),e=a(this).next().val();a(".users_page_wpum-custom-fields-editor tr").removeClass("editing"),a(".wpum-fields-editor").remove(),a.ajax({type:"POST",dataType:"json",url:wpum_admin_js.ajax,data:{action:"wpum_load_field_editor",field_meta:d,field_nonce:e},beforeSend:function(){var b=a(".wp-list-table").height();a(".wpum-table-loader").css("display","table"),a(".wpum-table-loader").css("height",b),a(c).addClass("editing")},success:function(b){a(".wpum-table-loader").hide(),a(b).insertAfter(c),a("html, body").animate({scrollTop:a(".wpum-fields-editor").offset().top},800),a("#delete-action a").on("click",function(b){return b.preventDefault(),a(c).removeClass("editing"),a(".wpum-fields-editor").remove(),a("html, body").animate({scrollTop:a(c).offset().top},800),!1})},error:function(b){a(".wpum-table-loader").hide(),alert(b.responseText)}})})}};b.init()});